function startbarrage(){try{clearInterval(timer),document.querySelector(".comment-barrage").innerHTML="",delete sw}catch(e){}const e={darkColors:[["#000a","black"]],lightColors:[["#fff","white"]],barrageTime:3e3,twikooUrl:"https://comment.cloudchewie.com/",accessToken:"df242fe099bf81ec336572476fbdc208",pageUrl:window.location.pathname,barrageTimer:[],barrageList:[],barrageIndex:0,noAvatarType:"retro",dom:document.querySelector(".comment-barrage"),displayBarrage:!1,avatarCDN:"cravatar.cn"};function a(e){if(e.replies){let r=[e];return e.replies.forEach((e=>{r.push(...a(e))})),r}return[]}function r(a){let r=document.createElement("div");e.dom.clientWidth,e.dom.clientHeight;r.className="comment-barrage-item";let n=Math.floor(Math.random()*e.lightColors.length);document.getElementById("barragesColor").innerHTML=`[data-theme='light'] .comment-barrage-item { background-color:${e.lightColors[n][0]};color:${e.lightColors[n][1]}}[data-theme='dark'] .comment-barrage-item{ background-color:${e.darkColors[n][0]};color:${e.darkColors[n][1]}}`,null!=a.avatar?null!=a.link?(t(a.link)||(a.link="http://"+a.link),r.innerHTML=`\n            <div class="barrageHead">\n                <img class="barrageAvatar" src="${a.avatar}"/>\n                <a href="${a.link}" class="barrageNick" target="_blank">${a.nick}</a>\n                <a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n            </div>\n            `):r.innerHTML=`\n            <div class="barrageHead">\n                <img class="barrageAvatar" src="${a.avatar}"/>\n                <div class="barrageNick">${a.nick}</div>\n                <a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n            </div>\n            `:null!=a.link?(t(a.link)||(a.link="http://"+a.link),r.innerHTML=`\n            <div class="barrageHead">\n                <img class="barrageAvatar" src="https://${e.avatarCDN}/avatar/${a.mailMd5}?d=${e.noAvatarType}"/>\n                <a href="${a.link}" class="barrageNick" target="_blank">${a.nick}</a>\n                <a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n            </div>\n            `):r.innerHTML=`\n            <div class="barrageHead">\n                <img class="barrageAvatar" src="https://${e.avatarCDN}/avatar/${a.mailMd5}?d=${e.noAvatarType}"/>\n                <div class="barrageNick">${a.nick}</div>\n                <a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n            </div>\n            `,barrageContent=document.createElement("a"),barrageContent.className="barrageContent",barrageContent.href="#"+a.id,barrageContent.innerHTML=a.comment,r.appendChild(barrageContent),aswiper=document.createElement("div"),aswiper.className="swiper-slide",aswiper.setAttribute("style","height: 150px;"),aswiper.append(r),e.dom.append(aswiper)}function t(e){var a=e;return 1==new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/).test(a)}switchCommentBarrage=function(){"true"==cloudchewieFn.loadData("enableCommentBarrage")?cloudchewieFn.saveData("enableCommentBarrage","false"):cloudchewieFn.saveData("enableCommentBarrage","true"),e.displayBarrage=!e.displayBarrage;let a=document.querySelector(".barrageswiper");a&&(e.displayBarrage?($("#con-barrage").addClass("checked"),$(a).show()):($("#con-barrage").removeClass("checked"),$(a).hide()))},function(){if(null==cloudchewieFn.loadData("enableCommentBarrage")&&cloudchewieFn.saveData("enableCommentBarrage","false"),"true"==cloudchewieFn.loadData("enableCommentBarrage")){e.displayBarrage=!0;let a=document.querySelector(".barrageswiper");a&&($("#con-barrage").addClass("checked"),$(a).show())}else{e.displayBarrage=!1;let a=document.querySelector(".barrageswiper");a&&($("#con-barrage").removeClass("checked"),$(a).hide())}var t=JSON.stringify({event:"COMMENT_GET","commentBarrageConfig.accessToken":e.accessToken,url:e.pageUrl}),n=new XMLHttpRequest;n.withCredentials=!0,n.addEventListener("readystatechange",(function(){if(4===this.readyState){for(e.barrageList=function(e){e.sort(((e,a)=>e.created-a.created));let r=[];return e.forEach((e=>{r.push(...a(e))})),r}(JSON.parse(this.responseText).data),e.dom.innerHTML="",e.barrageIndex=0;e.barrageIndex<e.barrageList.length;e.barrageIndex++)r(e.barrageList[e.barrageIndex]);var t=new Swiper(".barrageswiper",{direction:"vertical",loop:!0,mousewheel:!0,autoplay:{delay:e.barrageTime,stopOnLastSlide:!1,disableOnInteraction:!1}});t.el.onmouseover=function(){t.autoplay.stop()},t.el.onmouseout=function(){t.autoplay.start()}}})),n.open("POST",e.twikooUrl),n.setRequestHeader("Content-Type","application/json"),n.send(t),null!=document.querySelector("#con-barrage")&&(document.querySelector("#con-barrage").removeEventListener("click",switchCommentBarrage),document.querySelector("#con-barrage").addEventListener("click",switchCommentBarrage)),document.addEventListener("scroll",(function(){if(cloudchewieFn.isInViewPortOfOne(document.getElementById("post-comment"))){e.displayBarrage=!1;let a=document.querySelector(".barrageswiper");a&&$(a).hide(),$("#con-barrage").hide()}else{if("true"==cloudchewieFn.loadData("enableCommentBarrage")){e.displayBarrage=!0;let a=document.querySelector(".barrageswiper");a&&$(a).show()}$("#con-barrage").show()}})),setInterval((function(){$(".comment-barrage pangu").remove()}),10)}()}document.addEventListener("pjax:complete",startbarrage),document.addEventListener("DOMContentLoaded",startbarrage);